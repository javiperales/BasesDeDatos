  CREATE TABLE "CLIENTE" 
   (	"NIF" VARCHAR2(20), 
	"NOMBRE" VARCHAR2(20), 
	"RAZON_SOCIAL" VARCHAR2(20)
   ) ;
   
  CREATE TABLE "PAQUETE" 
   (	"ID_PAQUETE" NUMBER, 
	"PESO" FLOAT(126), 
	"DIRECCION_DESTINO" VARCHAR2(20), 
	"NIF" VARCHAR2(20), 
	"ID_VIAJE" NUMBER
   );
   
  CREATE TABLE "TRAMO" 
   (	"CLAVE_TRANSPORTE" NUMBER, 
	"NUMERO_TRAMO" NUMBER, 
	"ORIGEN" VARCHAR2(20), 
	"DESTINO" VARCHAR2(20), 
	"KILOM" NUMBER, 
	"PRECIO_KG" FLOAT(126)
   ) ;
   
   
  CREATE TABLE "TRAMO_PAQUETE" 
   (	"CLAVE_TRANSPORTE" VARCHAR2(20), 
	"NUMERO_TRAMO" VARCHAR2(20), 
	"ID_PAQUETE" VARCHAR2(20)
   ); 
  CREATE TABLE "TRANSPORTE" 
   (	"CLAVE" NUMBER, 
	"NOMBRE_TRANS" VARCHAR2(40), 
	"ORIGEN" VARCHAR2(20), 
	"DESTINO" VARCHAR2(20), 
	"HORA" VARCHAR2(20), 
	"DU" NUMBER, 
	"FRECUENCIA" VARCHAR2(20)
   ) ;
  CREATE TABLE "VEHICULO" 
   (	"MATRICULA" VARCHAR2(20), 
	"MARCA" VARCHAR2(20), 
	"MODELO" VARCHAR2(20), 
	"FECHA_FABRI" DATE, 
	"KLM" NUMBER
   ); 
  CREATE TABLE "VIAJE" 
   (	"ID_VIAJE" VARCHAR2(20), 
	"FECHA_SALIDA" TIMESTAMP (6), 
	"CLAVE_TRANSPORTE" NUMBER, 
	"MATRICULA_VEHICULO" VARCHAR2(20)
   ) ;

Insert into CLIENTE (NIF,NOMBRE,RAZON_SOCIAL) values ('12345678L','JUAN ALMUNIA','Avda Gómez Laguna 2');
Insert into CLIENTE (NIF,NOMBRE,RAZON_SOCIAL) values ('23456789F','JAMONES IGLESIAS','Plaza España 13');
Insert into CLIENTE (NIF,NOMBRE,RAZON_SOCIAL) values ('98765432H','FRUTAS PEREZ','Plaza Mayor 1');

Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('3','0,985','PLAZA ESPALA 2','98765432H','3');
Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('4','1,25','CALLE MAYOR 3','98765432H','3');
Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('6','5,25','CAMINO DEL SABADO 2','23456789F','2');
Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('7','3,05','CALLE MAYOR 3','98765432H','4');
Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('1','32,24','C/DEL PEZ 2','12345678L','1');
Insert into PAQUETE (ID_PAQUETE,PESO,DIRECCION_DESTINO,NIF,ID_VIAJE) values ('2','2,15','C/ LA LUZ 1','12345678L','1');

Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('1','1','CALAMOCHA','CARIÑENA','90','1,236');
Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('1','2','CARIÑENA','ZARAGOZA','50','0,125');
Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('2','1','ZARAGOZA','JACA','150','3,256');
Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('3','1','ZARAGOZA','FUENTES','35','0,986');
Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('3','2','FUENTES','ALCAÑIZ','65','2,546');
Insert into TRAMO (CLAVE_TRANSPORTE,NUMERO_TRAMO,ORIGEN,DESTINO,KILOM,PRECIO_KG) values ('3','3','ALCAÑIZ','MALLEN','60','2,001');

Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('1','1','1');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('1','1','2');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('1','2','1');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('2','1','6');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('3','1','4');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('3','2','3');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('3','3','3');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('1','1','7');
Insert into TRAMO_PAQUETE (CLAVE_TRANSPORTE,NUMERO_TRAMO,ID_PAQUETE) values ('1','2','7');

Insert into TRANSPORTE (CLAVE,NOMBRE_TRANS,ORIGEN,DESTINO,HORA,DU,FRECUENCIA) values ('2','ZARAGOZA-JACA','ZARAGOZA','JACA','18:30','2','LMXJVSD');
Insert into TRANSPORTE (CLAVE,NOMBRE_TRANS,ORIGEN,DESTINO,HORA,DU,FRECUENCIA) values ('3','ZARAGOZA-MALLEN','ZARAGOZA','MALLEN','05:45','4','LMXJV--');
Insert into TRANSPORTE (CLAVE,NOMBRE_TRANS,ORIGEN,DESTINO,HORA,DU,FRECUENCIA) values ('1','CALAMOCHA-ZARAGOZA','CALAMOCHA','ZARAGOZA','09:00','4','LMXJV--');

Insert into VEHICULO (MATRICULA,MARCA,MODELO,FECHA_FABRI,KLM) values ('1478BBA','SCANIA','STOCK',to_date('08/05/93','DD/MM/RR'),'15000');
Insert into VEHICULO (MATRICULA,MARCA,MODELO,FECHA_FABRI,KLM) values ('5689DFG','SCANIA','STOCK',to_date('06/06/02','DD/MM/RR'),'1500');
Insert into VEHICULO (MATRICULA,MARCA,MODELO,FECHA_FABRI,KLM) values ('8965ADD','RENAULT','TM1',to_date('18/12/96','DD/MM/RR'),'97000');
Insert into VEHICULO (MATRICULA,MARCA,MODELO,FECHA_FABRI,KLM) values ('9632BCD','RENAULT','SDC',to_date('04/08/00','DD/MM/RR'),'9000');

Insert into VIAJE (ID_VIAJE,FECHA_SALIDA,CLAVE_TRANSPORTE,MATRICULA_VEHICULO) values ('1',to_timestamp('10/04/17 19:07:00,000000000','DD/MM/RR HH24:MI:SSXFF'),'1','1478BBA');
Insert into VIAJE (ID_VIAJE,FECHA_SALIDA,CLAVE_TRANSPORTE,MATRICULA_VEHICULO) values ('2',to_timestamp('12/05/17 19:07:00,000000000','DD/MM/RR HH24:MI:SSXFF'),'2','1478BBA');
Insert into VIAJE (ID_VIAJE,FECHA_SALIDA,CLAVE_TRANSPORTE,MATRICULA_VEHICULO) values ('4',to_timestamp('23/04/18 10:00:00,000000000','DD/MM/RR HH24:MI:SSXFF'),'1','8965ADD');
Insert into VIAJE (ID_VIAJE,FECHA_SALIDA,CLAVE_TRANSPORTE,MATRICULA_VEHICULO) values ('3',to_timestamp('25/06/18 10:00:00,000000000','DD/MM/RR HH24:MI:SSXFF'),'3','8965ADD');
Insert into VIAJE (ID_VIAJE,FECHA_SALIDA,CLAVE_TRANSPORTE,MATRICULA_VEHICULO) values ('5',to_timestamp('01/08/18 18:00:00,000000000','DD/MM/RR HH24:MI:SSXFF'),'2','9632BCD');


  ALTER TABLE "CLIENTE" ADD CONSTRAINT "CLIENTE_PK" PRIMARY KEY ("NIF");

  ALTER TABLE "PAQUETE" ADD CONSTRAINT "PAQUETE_PK" PRIMARY KEY ("ID_PAQUETE");
 
  ALTER TABLE "TRAMO" ADD CONSTRAINT "TRAMO_PK" PRIMARY KEY ("CLAVE_TRANSPORTE", "NUMERO_TRAMO");
 
  ALTER TABLE "TRAMO_PAQUETE" ADD CONSTRAINT "TRAMO_PAQUETE_PK" PRIMARY KEY ("CLAVE_TRANSPORTE", "NUMERO_TRAMO", "ID_PAQUETE");

  ALTER TABLE "TRANSPORTE" ADD CONSTRAINT "TRANSPORTE_PK" PRIMARY KEY ("CLAVE");

  ALTER TABLE "VEHICULO" ADD CONSTRAINT "VEHICULO_PK" PRIMARY KEY ("MATRICULA");

  ALTER TABLE "VIAJE" ADD CONSTRAINT "VIAJE_PK" PRIMARY KEY ("ID_VIAJE");
  
  delete from transporte
    where nombre_trans='CALAMOCHA-ZARAGOZA'
    
  insert into transporte (clave,nombre_trans,origen,destino,hora,du,frecuencia)
  values ((select max(clave) from transporte)+1, 'TERUEL-ZARAGOZA', 'TERUEL', 'ZARAGOZA','10:00' , 5 , 'LMXJV--');
  
  insert into tramo (clave_transporte, numero_tramo,origen,destino,kilom,precio_kg)
  values ((SELECT MAX(CLAVE) from transporte)+1 , (select max(numero_tramo) from tramo_paquete)+1, 'TERUEL', 'ZARAGOZA', 120, 2.03);
  
  insert into tramo (clave_transporte, numero_tramo,origen,destino,kilom,precio_kg)
  values ((SELECT MAX(CLAVE_TRANSPORTE) from TRAMO)+1 , (select max(numero_tramo) from TRAMO)+1, 'CALAMOCHA', 'TERUEL', 60, 2.50);
  
  DELETE FROM PAQUETE
    WHERE ID_VIAJE IN (
      SELECT ID_VIAJE FROM VIAJE
        WHERE CLAVE_TRANSPORTE NOT IN (SELECT CLAVE FROM TRANSPORTE)
          AND
            VIAJE.FECHA_SALIDA <SYSDATE);
            
  DELETE FROM TRAMO_PAQUETE
    WHERE ID_PAQUETE IN (
      SELECT ID_VIAJE FROM VIAJE
        WHERE CLAVE_TRANSPORTE NOT IN (SELECT CLAVE FROM TRANSPORTE)
          AND
            VIAJE.FECHA_SALIDA <SYSDATE);
            
  
  
  
  SELECT VI.ID_VIAJE , TRANS.NOMBRE_TRANS , VI.FECHA_SALIDA, TRA.PRECIO_KG*PA.PESO*M AS PRECIO FROM VIAJE VI , TRANSPORTE TRANS , TRAMO TRA, PAQUETE PA
  GROUP BY VI.ID_VIAJE, TRANS.NOMBRE_TRANS,VI.FECHA_SALIDA, TRA.PRECIO_KG*PA.PESO;

  


  
  
  select nombre , nif, razon_social from cliente
    where nif in(
      select distinct nif from paquete
        where id_viaje in (
          select id_viaje from paquete 
            where nif=(
              select nif from cliente
                where nombre like 'FRUTAS PEREZ')));
                
                